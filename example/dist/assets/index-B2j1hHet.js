(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function a(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=a(e);fetch(e.href,n)}})();const S={packetId:0,buttonL:!1,buttonR:!1,buttonMinus:!1,buttonPlus:!1,buttonLStick:!1,buttonRStick:!1,buttonA:!1,buttonB:!1,buttonC:!1,buttonX:!1,buttonY:!1,buttonUp:!1,buttonDown:!1,buttonLeft:!1,buttonRight:!1,buttonCapture:!1,buttonHome:!1,buttonZR:!1,buttonZL:!1,buttonSR_R:!1,buttonSL_R:!1,buttonSR_L:!1,buttonSL_L:!1,leftStickX:0,leftStickY:0,rightStickX:0,rightStickY:0,mouseX:0,mouseY:0,mouseUnknown:0,mouseDistance:0,magX:0,magY:0,magZ:0,batteryVoltage:0,batteryCurrent:0,temperature:0,accelX:0,accelY:0,accelZ:0,gyroX:0,gyroY:0,gyroZ:0,triggerL:0,triggerR:0,simpleParsed:{packetId:0,buttons:0,leftStick:0,rightStick:0,mouseX:0,mouseY:0,mouseUnknown:0,mouseDistance:0,magX:0,magY:0,magZ:0,batteryVoltage:0,batteryCurrent:0,temperature:0,accelX:0,accelY:0,accelZ:0,gyroX:0,gyroY:0,gyroZ:0,triggerL:0,triggerR:0},rawData:new Uint8Array},u="ab7de9be-89fe-49ad-828f-118f09df7fd0",k="ab7de9be-89fe-49ad-828f-118f09df7fd2";function h(s,t){const a=s.getUint8(t),i=s.getUint8(t+1);return s.getUint8(t+2)<<16|i<<8|a}const w=2e3,E=1e3,L=3e3,X=2e3,Y=1e3,I=3e3;function l(s,t,a,i){if(s>t){const e=(s-t)/(i-t);return Math.min(e,1)}else{const e=(s-t)/(t-a);return Math.max(e,-1)}}function m(s,t,a){return Math.max(t,Math.min(a,s))}function g(s){return Math.round(s*100)/100}function C(s,t,a=.15){const i=Math.sqrt(s*s+t*t);if(i<a)return[0,0];const e=(i-a)/(1-a);let n=s/i*e,r=t/i*e;return n=m(g(n),-1,1),r=m(g(r),-1,1),[n,r]}function f(s,t){let a=l(s,w,E,L),i=l(t,X,Y,I);return C(a,i,.15)}class R extends EventTarget{constructor(){super(),this.data={...S},this.device=null,this.server=null,this.characteristic=null}async connect(){try{const t=await navigator.bluetooth.requestDevice({filters:[{manufacturerData:[{companyIdentifier:1363,dataPrefix:new Uint8Array([0,0,0,0,0,103,32]),mask:new Uint8Array([0,0,0,0,0,0,255])}]}],optionalServices:[u]});if(this.device=t,this.server=await t.gatt?.connect()??null,!this.server)throw new Error("GATT server not available");const a=await this.server.getPrimaryService(u);this.characteristic=await a.getCharacteristic(k),await this.characteristic.startNotifications(),this.characteristic.addEventListener("characteristicvaluechanged",i=>{const e=i.target.value;this.handleData(e)}),this.dispatchEvent(new CustomEvent("connected"))}catch(t){throw this.dispatchEvent(new CustomEvent("error",{detail:t})),t}}disconnect(){this.device&&this.device.gatt&&this.device.gatt.connected&&this.device.gatt.disconnect(),this.device=null,this.server=null,this.characteristic=null,this.dispatchEvent(new CustomEvent("disconnected"))}onUpdate(t){this.addEventListener("update",()=>t(this.data))}handleData(t){this.data.rawData=new Uint8Array(t.buffer),this.data.simpleParsed={packetId:t.getUint32(0,!0),buttons:t.getUint32(4,!0),leftStick:h(t,10),rightStick:h(t,13),mouseX:t.getInt16(16,!0),mouseY:t.getInt16(18,!0),mouseUnknown:t.getInt16(20,!0),mouseDistance:t.getInt16(22,!0),magX:t.getInt16(24,!0),magY:t.getInt16(26,!0),magZ:t.getInt16(28,!0),batteryVoltage:t.getUint16(31,!0),batteryCurrent:t.getInt16(40,!0),temperature:t.getInt16(46,!0),accelX:t.getInt16(48,!0),accelY:t.getInt16(50,!0),accelZ:t.getInt16(52,!0),gyroX:t.getInt16(54,!0),gyroY:t.getInt16(56,!0),gyroZ:t.getInt16(58,!0),triggerL:t.getUint8(60),triggerR:t.getUint8(61)},this.data.packetId=this.data.simpleParsed.packetId,this.data.buttonY=(this.data.simpleParsed.buttons&1)!==0,this.data.buttonX=(this.data.simpleParsed.buttons&2)!==0,this.data.buttonB=(this.data.simpleParsed.buttons&4)!==0,this.data.buttonA=(this.data.simpleParsed.buttons&8)!==0,this.data.buttonSR_R=(this.data.simpleParsed.buttons&16)!==0,this.data.buttonSL_R=(this.data.simpleParsed.buttons&32)!==0,this.data.buttonR=(this.data.simpleParsed.buttons&64)!==0,this.data.buttonZR=(this.data.simpleParsed.buttons&128)!==0,this.data.buttonMinus=(this.data.simpleParsed.buttons&256)!==0,this.data.buttonPlus=(this.data.simpleParsed.buttons&512)!==0,this.data.buttonRStick=(this.data.simpleParsed.buttons&1024)!==0,this.data.buttonLStick=(this.data.simpleParsed.buttons&2048)!==0,this.data.buttonHome=(this.data.simpleParsed.buttons&4096)!==0,this.data.buttonCapture=(this.data.simpleParsed.buttons&8192)!==0,this.data.buttonC=(this.data.simpleParsed.buttons&16384)!==0,this.data.buttonDown=(this.data.simpleParsed.buttons&65536)!==0,this.data.buttonUp=(this.data.simpleParsed.buttons&1<<17)!==0,this.data.buttonRight=(this.data.simpleParsed.buttons&1<<18)!==0,this.data.buttonLeft=(this.data.simpleParsed.buttons&1<<19)!==0,this.data.buttonSR_L=(this.data.simpleParsed.buttons&1<<20)!==0,this.data.buttonSL_L=(this.data.simpleParsed.buttons&1<<21)!==0,this.data.buttonL=(this.data.simpleParsed.buttons&1<<22)!==0,this.data.buttonZL=(this.data.simpleParsed.buttons&1<<23)!==0,this.data.leftStickY=this.data.simpleParsed.leftStick>>12&4095,this.data.leftStickX=this.data.simpleParsed.leftStick&4095,this.data.rightStickY=this.data.simpleParsed.rightStick>>12&4095,this.data.rightStickX=this.data.simpleParsed.rightStick&4095,this.data.mouseX=this.data.simpleParsed.mouseX,this.data.mouseY=this.data.simpleParsed.mouseY,this.data.mouseUnknown=this.data.simpleParsed.mouseUnknown,this.data.mouseDistance=this.data.simpleParsed.mouseDistance,this.data.magX=this.data.simpleParsed.magX,this.data.magY=this.data.simpleParsed.magY,this.data.magZ=this.data.simpleParsed.magZ,this.data.batteryVoltage=this.data.simpleParsed.batteryVoltage,this.data.batteryCurrent=this.data.simpleParsed.batteryCurrent/100,this.data.temperature=25+this.data.simpleParsed.temperature/127,this.data.accelX=this.data.simpleParsed.accelX/4096,this.data.accelY=this.data.simpleParsed.accelY/4096,this.data.accelZ=this.data.simpleParsed.accelZ/4096,this.data.gyroX=this.data.simpleParsed.gyroX/48e3*360,this.data.gyroY=this.data.simpleParsed.gyroY/48e3*360,this.data.gyroZ=this.data.simpleParsed.gyroZ/48e3*360,this.data.triggerL=this.data.simpleParsed.triggerL,this.data.triggerR=this.data.simpleParsed.triggerR,[this.data.rightStickX,this.data.rightStickY]=f(this.data.rightStickX,this.data.rightStickY),[this.data.leftStickX,this.data.leftStickY]=f(this.data.leftStickX,this.data.leftStickY),this.dispatchEvent(new CustomEvent("update",{detail:this.data}))}}class U extends EventTarget{constructor(){super(),this.dev=new R,this.dev.addEventListener("update",t=>this.dispatchEvent(new CustomEvent("update",{detail:t.detail}))),this.dev.addEventListener("connected",t=>this.dispatchEvent(new CustomEvent("connected"))),this.dev.addEventListener("disconnected",t=>this.dispatchEvent(new CustomEvent("disconnected"))),this.dev.addEventListener("error",t=>this.dispatchEvent(new CustomEvent("error",{detail:t.detail})))}async connect(){return this.dev.connect()}disconnect(){return this.dev.disconnect()}get gJoyCon2Data(){return this.dev.data}onUpdate(t){this.addEventListener("update",()=>t(this.gJoyCon2Data))}}const P=new U;document.getElementById("ble-connect")?.addEventListener("click",async()=>{try{await P.connect(),console.log("connected")}catch(s){console.error("connect error",s)}});P.addEventListener("update",s=>{const t=s.detail;document.getElementById("raw-data").textContent=Array.from(t.rawData).map(a=>a.toString(16).padStart(2,"0")).join(" "),t.simpleParsed&&typeof t.simpleParsed=="object"&&Object.entries(t.simpleParsed).forEach(([a,i])=>{const e=document.getElementById("smpl-"+a);e&&(e.textContent=String(i))}),b("leftStickSim",t.leftStickX,t.leftStickY),b("rightStickSim",t.rightStickX,t.rightStickY),Object.entries(t).forEach(([a,i])=>{const e=document.getElementById(a);e&&(e.textContent=String(i)),i===!0&&p(a,!0),i===!1&&p(a,!1)})});function p(s,t){const a=document.getElementById(s);a&&(a.textContent=t?"ON":"OFF",t?a.classList.add("bg-primary","text-white"):a.classList.remove("bg-primary","text-white"))}function b(s,t,a){const i=document.getElementById(s);if(!i)return;const e=i.getContext("2d");if(!e)return;const n=i.width,r=n/2,d=n/2-5,o=6,c=Math.sqrt(t*t+a*a);c>1&&(t=t/c,a=a/c),e.clearRect(0,0,n,n),e.beginPath(),e.arc(r,r,d,0,Math.PI*2),e.strokeStyle="#888",e.lineWidth=2,e.stroke(),e.beginPath(),e.moveTo(r-d,r),e.lineTo(r+d,r),e.moveTo(r,r-d),e.lineTo(r,r+d),e.strokeStyle="#ccc",e.lineWidth=1,e.stroke();const v=r+t*(d-o),y=r-a*(d-o);e.beginPath(),e.arc(v,y,o,0,Math.PI*2),e.fillStyle="#007bff",e.fill()}
//# sourceMappingURL=index-B2j1hHet.js.map
